= Module 4 Lab 1: AI - Ansible Lightspeed Intelligent Assistant

[.sidebar]
****
* **Before you start:**
** Access to OpenShift Dev Spaces and AAP in xref:environment-details.adoc[Environment Details]
* **Prepares you for:** Using Ansible Lightspeed Intelligent Assistant
* **Lab Type:** Self-Contained (_You can skip this lab without missing steps for other labs_)
* **Estimated Time:** 10 - 20 minutes
****

[abstract]
We will explore how to begin to integrate generative Artificial Intelligence (AI) capabilities with Ansible Automation Platform (AAP) using the Ansible Lightspeed Intelligent Assistant. This lab will guide you through the process of deploying Ansible Lightspeed intelligent assistant and interacting with the service within the Ansible Automation Platform user interface.

== Learning Objectives

After completing this module, you will be able to:

* Deploy and configure Ansible Lightspeed intelligent assistant
* Interact with Ansible Lightspeed intelligent assistant within Ansible Automation Platform interface
* Understand the role of Ansible Lightspeed intelligent assistant within Ansible Automation Platform

== 1: Introduction: Ansible Lightspeed intelligent assistant

Ansible Lightspeed intelligent assistant is a chat interface embedded within the Ansible Automation Platform, using generative artificial intelligence (AI) to answer questions about the Ansible Automation Platform.

The Ansible Lightspeed intelligent assistant enables users to use natural language prompts in English and Large Language Models (LLM's)to generate quick, accurate, and personalized responses. These responses empower Ansible users to work more efficiently, thereby improving productivity and the overall quality of their work.

== 2: LLM Support

=== 2.1: LLM Requirements

An LLM provider must be available for use by the Ansible Lightspeed intelligent assistant. As of Ansible Automation Platform 2.6, the following LLM providers are supported:

* Red Hat Providers 
** Red Hat Enterprise Linux AI
** Red Hat OpenShift AI
** Red Hat AI Inference Server
* Third-Party Providers
** OpenAI
** Microsoft Azure OpenAI

=== 2.2: Access to LLM's in this Lab Environment

The lab environment has been configured to leverage models provided by a self hosted link:https://www.litellm.ai[LiteLLM,window=_blank] instance. Access to models are available to you with details provided in the xref:environment-details.adoc[Environment Details,window=_blank] page.

=== 3: Deploying Ansible Lightspeed intelligent assistant

Utilize the steps within this section to deploy and configure Ansible Lightspeed intelligent assistant

==== 3.1: Configuring Ansible Lightspeed intelligent

The configuration for the Ansible Lightspeed intelligent assistant is provided within a _Secret_ resource in the same namespace as Ansible Automation Platform. This configuration secret requires the following keys to be provided:

* `chatbot_model` - Name of the LLM model for use
* `chatbot_url` - Base URL for the inference service
* `chatbot_token` - API key for the inference service

Configure the Secret by performing the following;

. Launch the link:{openshift_cluster_console_url}[OpenShift Web Console,window=_blank]
. Select the **htpasswd_provider** button and use the credentials provided in the xref:environment-details.adoc[Environment Details,window=_blank] page to login to the OpenShift console
. Navigate to **Workloads** on the left hand navigation -> **Secrets**. From the project dropdown at the top, select **aap**.
. Click on the **Create** button and select **Key/value secret**.
+
image::41-ai-lightspeed-int-assistant/secrets-overview.png[Secrets Contained in the AAP Project]
+
. For the _Secret name_, enter `alia-chatbot-secret`.
. For the _Key_ enter `chatbot_model`
. For the _Value_ enter the name of the model you would like to use. For a list of available models, consult the xref:environment-details.adoc[Environment Details,window=_blank] page.
. Click the **Add key/value** link to add another key/value pair.
. For the new _Key_ enter `chatbot_url`
. For the _value_ enter the base URL for the inference service: {litellm_api_base_url}
. Click the **Add key/value** link to add another key/value pair.
. For the new _Key_ enter `chatbot_token`
. For the _Value_ enter the API key: `{litellm_virtual_key}`
. Click the **Create** button.

==== 3.2: Enabling Ansible Lightspeed intelligent

Ansible Automation intelligent assistant is enabled by updating the  `AnsibleAutomationPlatform` custom resource. Update the `AnsibleAutomationPlatform` resource in the _aap_ Project by performing the following in the OpenShift web console:

. Navigate to **Ecosystem** -> **Installed Operators**
. From the _Project_ dropdown, ensure `aap` is selected
. The `Ansible Automation Platform` operator is listed and installed within this project.
+
image::41-ai-lightspeed-int-assistant/installed-operators-aap.png[Installed Operators in the aap Project]
+
. Click on the `Ansible Automation Platform` operator which will display all of the resources that are managed by the operator.
. In the top tab, click on `Ansible Automation Platform` and select **aap**.
+
image::41-ai-lightspeed-int-assistant/ansible-automation-platform-instances.png[Ansible Automation Platform Instances in the aap Project]
+
. Click on the **YAML** tab to edit the resource in YAML format.
. Locate the `spec.lightspeed` section update the configuration to match the following:
+
[source,yaml]
---
spec:
  lightspeed:
    disabled: false
    chatbot_config_secret_name: alia-chatbot-secret
---
+
. Click the **Save** button to apply the changes.

Once the configuration has been applied, the Ansible Automation Platform operator will begin to reconcile the changes. This process can take several minutes to complete.

Confirm the AAP operator detected the changes by verifying the Ansible Lightspeed intelligent assistant _Deployments_ have been created by navigating to **Workloads** -> **Deployments**. Two Deployment resources are created as part of this process:

. `<instance_name>-lightspeed-api`
. `<instance_name>-lightspeed-chatbot-api`

image::41-ai-lightspeed-int-assistant/lightspeed-deployments.png[Ansible Lightspeed intelligent assistant Deployments]

You can confirm that the Pods associated with these Deployments are running by selecting each Deployment and navigating to the _Pods_ tab.

== 4: Using Ansible Lightspeed intelligent assistant

Now that Ansible Lightspeed intelligent assistant has been deployed and configured, you can interact with the assistant within the Ansible Automation Platform user interface.

Launch the link:{aap_controller_web_url}[Ansible Automation Platform,window=_blank] web interface and login using the credentials from the xref:environment-details.adoc[Environment Details,window=_blank] page.

When Ansible Lightspeed intelligent assistant is available, a chat icon will be present on the navigation bar at the top of the console. Click on the chat icon to launch the Ansible Lightspeed intelligent assistant interface which will appear on the right side of the screen.

image::41-ai-lightspeed-int-assistant/alia-overview.png[Accessing Ansible Lightspeed intelligent assistant in AAP]

You can now enter natural language prompts in the chat interface to interact with the Ansible Lightspeed intelligent assistant. For example, you can ask questions about Ansible Automation Platform features, request help with playbook development, or seek guidance on best practices.

Enter a prompt in the chat interface and click the **Send** button (For example "What is a Job Template?"). The assistant will process your request and provide a response based on the information available service.

image::41-ai-lightspeed-int-assistant/alia-response.png[Chat Interaction with Ansible Lightspeed intelligent assistant]

[NOTE]
====
You may experience an issue where the Ansible Lightspeed intelligent assistant provides a response similar to the following:

[source,xml]
----
<tool_calls>[{"name": "knowledge_search", "arguments": {"query": "job template in Ansible"}}]</tool_calls>
----

This is a link:https://issues.redhat.com/browse/AAP-60898[known issue,window=_blank] which will be addressed in a future release of Ansible Automation Platform. To resolve this issue, simply retry the request by entering the same prompt again.
====

Continue conversing with the Ansible Lightspeed intelligent assistant to explore its capabilities and how it can assist you with your Ansible Automation Platform tasks.

== Conclusion

In this lab, you have successfully learned how to deploy and configure Ansible Lightspeed intelligent assistant within Ansible Automation Platform. 

. Reviewed how Ansible Lightspeed intelligent assistant integrates generative AI capabilities with Ansible Automation Platform
. Configured an OpenShift _Secret_ containing the necessary LLM connection details
. Deployed the Ansible Lightspeed intelligent assistant by updating the `AnsibleAutomationPlatform` custom resource
. Interacted with Ansible Lightspeed intelligent assistant through the AAP user interface

== Helpful Links

. link:https://www.redhat.com/en/technologies/management/ansible/ansible-lightspeed[Ansible Lightspeed Website,window=_blank]
. link:https://docs.redhat.com/en/documentation/red_hat_ansible_automation_platform/2.6/html/installing_on_openshift_container_platform/deploying-chatbot-operator[Ansible Lightspeed intelligent assistant Documentation,window=_blank]
